<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough">

<h:head>
    <meta charset="UTF-8" />
    <title>Gerenciador de Tarefas</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.2/darkly/bootstrap.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&amp;display=swap" rel="stylesheet" />
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .navbar-custom { background-color: #222 !important; box-shadow: 0 2px 10px rgba(0,0,0,0.5); margin-bottom: 30px; }
        .card-custom { border: 1px solid #444; border-radius: 10px; background-color: #303030; box-shadow: 0 8px 16px rgba(0,0,0,0.3); }
        
        .form-control {
            background-color: #444 !important;
            color: #eee !important;
            border: 1px solid #555;
            border-radius: 6px;
        }
        .form-control:focus { background-color: #505050 !important; border-color: #375a7f; }
        select.form-control option { background-color: #444; color: #eee; }
        
        .btn-primary { border-radius: 6px; font-weight: 500; }
        .table th { border-top: none; color: #aaa; font-weight: 600; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px; }
        .action-link { font-weight: 500; font-size: 0.9rem; text-decoration: none !important; transition: opacity 0.2s; }
        .action-link:hover { opacity: 0.7; }
        label { color: #ddd; }
    </style>
</h:head>

<h:body>
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
        <div class="container">
            <a class="navbar-brand font-weight-bold" href="listagem.xhtml">✅ Gerenciador de Tarefas</a>
        </div>
    </nav>

    <div class="container">
        <div class="card card-custom p-4 mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="m-0 font-weight-bold text-white">Listagem de Tarefas</h5>
                <h:link outcome="index" value="+ Nova Tarefa" class="btn btn-primary" />
            </div>
            
            <h:form id="formBusca">
                <div class="row align-items-end">
                    <div class="col-md-2 form-group mb-0">
                        <h:outputLabel value="Número:" class="small font-weight-bold mb-1" />
                        <h:inputText value="#{taskMB.task.id}" class="form-control form-control-sm" />
                    </div>
                    <div class="col-md-3 form-group mb-0">
                        <h:outputLabel value="Título/Descrição:" class="small font-weight-bold mb-1" />
                        <h:inputText value="#{taskMB.task.title}" class="form-control form-control-sm" />
                    </div>
                    <div class="col-md-3 form-group mb-0">
                        <h:outputLabel value="Responsável:" class="small font-weight-bold mb-1" />
                        <h:selectOneMenu value="#{taskMB.profile.id}" class="form-control form-control-sm">
                            <f:selectItem itemLabel="Todos" itemValue="" />
                            <f:selectItems value="#{taskMB.profiles}" var="p" itemLabel="#{p.name}" itemValue="#{p.id}" />
                        </h:selectOneMenu>
                    </div>
                    
                    <div class="col-md-2 form-group mb-0">
                        <h:outputLabel value="Situação:" class="small font-weight-bold mb-1" />
                        <h:selectOneMenu value="#{taskMB.task.status}" class="form-control form-control-sm">
                            <f:selectItem itemLabel="Todas" itemValue="" />
                            <f:selectItem itemLabel="Em andamento" itemValue="false" />
                            <f:selectItem itemLabel="Concluída" itemValue="true" />
                        </h:selectOneMenu>
                    </div>

                    <div class="col-md-2 form-group mb-0">
                        <h:commandButton value="Buscar" action="#{taskMB.findTask()}" class="btn btn-secondary btn-sm w-100 font-weight-bold" style="height: 31px;" />
                    </div>
                </div>
            </h:form>
        </div>

        <div class="card card-custom overflow-hidden">
            <h:form id="formTabela">
                <h:dataTable value="#{taskMB.taskList}" var="t" class="table table-hover table-dark mb-0">
                    <h:column>
                        <f:facet name="header">ID</f:facet>
                        <span class="text-muted">##{t.id}</span>
                    </h:column>
                    <h:column>
                        <f:facet name="header">Título</f:facet>
                        <strong>#{t.title}</strong>
                    </h:column>
                    <h:column>
                        <f:facet name="header">Responsável</f:facet>
                        <span class="badge badge-secondary">#{t.responsible.name}</span>
                    </h:column>
                    <h:column>
                        <f:facet name="header">Ações</f:facet>
                        <h:commandLink value="Editar" action="#{taskMB.redirectToEdit(t.id)}" class="action-link text-info mr-3" />
                        <h:commandLink value="Concluir" action="#{taskMB.doneTask(t.id)}" rendered="#{not t.status}" class="action-link text-success mr-3" />
                        <h:commandLink value="Excluir" action="#{taskMB.deleteTask(t.id)}" onclick="return confirm('Tem certeza que deseja excluir esta tarefa?')" class="action-link text-danger" />
                    </h:column>
                </h:dataTable>
            </h:form>
        </div>
    </div>
</h:body>
</html>